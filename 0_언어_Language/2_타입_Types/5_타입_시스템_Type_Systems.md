# Dart의 타입 시스템 The Dart type system

다트는 타입 안전한 언어입니다. 다트 언어는 변수의 값이 항상 변수의 정적 타입과 일치함을 보장하기 위해 정적 타입 검사와 런타임 검사의 조합을 사용합니다(때때로 건전한 타입이라고도 함). 타입을 표기하는 것은 의무적이지만 타입 추론때문에 타입 주석은 선택적입니다.

정적 타입 검사의 한 가지 이점은 다트의 정적 분석기를 사용하여 컴파일 타임에 버그를 찾는 능력입니다.

제네릭 클래스에 타입 주석을 추가하면 대부분의 정적 분석 오류를 고칠 수 있습니다. 가장 일반적인 제네릭 클래스는 컬렉션 타입 List<T>와 Map<K, V>입니다.

예를 들어, 아래와 같은 코드에서 printInts() 함수는 정수 리스트를 출력하고, main() 함수는 리스트를 만들어 printInts()에 전달합니다.

```dart
void printInts(List<int> a) => print(a);

void main() {
  final list = [];

  list.add(1);
  list.add('2');
  printInts(list);
}
```

위의 코드는 printInts(list)를 호출할 때 list에서 타입 오류가 발생합니다:

```
error - The argument type 'List<dynamic>' can't be assigned to the parameter type 'List<int>'. - argument_type_not_assignable
```

오류는 List<dynamic>에서 List<int>로 불건전한 암묵적 타입 캐스팅을 강조합니다. list 변수는 정적 타입 List<dynamic>입니다. 이것은 초기화 선언 var list = []이 dynamic보다 더 구체적인 타입 인자를 추론할만한 충분한 정보를 분석기에 제공하지 않았기 때문입니다. printInts() 함수는 타입 List<int>의 매개변수를 예상하므로 타입 불일치가 발생합니다.

타입 주석(<int>와 같은)을 리스트 생성에 추가할 때 분석기는 문자열 인자를 정수 매개변수에 할당할 수 없다고 알려줍니다. 코드의 list.add('2')에서 홑따옴표를 제거하면 정적 분석을 통과하고 오류나 경고 없이 실행합니다.

```dart
void printInts(List<int> a) => print(a);

void main() {
  final list = <int>[];
  list.add(1);
  list.add(2);
  printInts(list);
}
```

DartPad에서 확인해보세요.

## 건전성이란 무엇인가? What is soundness?

건전성은 프로그램이 유효하지 않은 특정 상태가 될 수 없도록 보장하는 것입니다. 건전한 타입 시스템은 표현식이 표현식의 정적 타입과 일치하지 않는 값을 평가하는 상태가 될 수 없음을 의미합니다. 예를 들어 표현식의 정적 타입이 String이라면 런타임에 표현식을 평가할 때 문자열만 얻는 것이 보장됩니다.

Dart의 타입 시스템은 Java, C#처럼 건전합니다. 정적 검사(컴파일 타임 오류)와 런타임 검사의 조합을 사용하여 건전성을 강제합니다. 예를 들어, String을 int에 할당하면 컴파일 타임 오류가 발생합니다. String이 아닌 객체에 as String을 사용하여 String으로 캐스팅하면 런타임 오류와 함께 실패합니다.

## 건전성의 이점 The benefits of soundness

건전한 타입 시스템은 몇 가지 이점이 있습니다:

- 컴파일 타임에 타입 관련 버그를 드러냅니다.
    건전한 타입 시스템은 코드가 타입이 명확하도록 강제하여 런타임에 발견하기 어려운 타입 관련 버그가 컴파일 타임에 드러나도록 합니다.

- 더 읽기 쉬운 코드.
    실제로 구체적인 타입을 갖는 값에 의존하므로 코드가 더 읽기 쉽습니다. 건전한 Dart에서 타입은 거짓말할 수 없습니다.

- 더 유지보수가 가능한 코드.
    건전한 타입 시스템을 사용하면 코드 하나를 변경할 때 타입 시스템이 손상된 코드에 대해 경고할 수 있습니다.

- 더 나은 AOT 컴파일.
    AOT 컴파일은 타입없이 가능하지만, 생성된 코드는 덜 효율적입니다.

## 정적 분석 통과에 대한 팁 Tips for passing static analysis

정적 타입에 대한 대부분의 규칙은 이해하기 쉽습니다. 여기 덜 명백한 규칙 몇 가지가 있습니다.

- 메서드를 재정의할 때 건전한 반환 타입을 사용하세요.
- 메서드를 재정의할 때 건전한 매개변수를 사용하세요.
- dynamic 리스트를 타입이 있는 리스트처럼 사용하지 마세요.

위의 규칙들을 다음의 타입 계층 구조를 사용한 예시와 함께 세부적으로 살펴봅시다.